{"version":3,"file":"matrix.esm.js","sources":["../src/index.ts"],"sourcesContent":["import { average, throttle, TINY_NUM } from \"@daybrush/utils\";\n\nfunction add(\n    matrix: number[],\n    inverseMatrix: number[],\n    startIndex: number,\n    fromIndex: number,\n    n: number,\n    k: number,\n) {\n    for (let i = 0; i < n; ++i) {\n        const x = startIndex + i * n;\n        const fromX = fromIndex + i * n;\n        matrix[x] += matrix[fromX] * k;\n        inverseMatrix[x] += inverseMatrix[fromX] * k;\n    }\n}\n\nfunction swap(\n    matrix: number[],\n    inverseMatrix: number[],\n    startIndex: number,\n    fromIndex: number,\n    n: number,\n) {\n    for (let i = 0; i < n; ++i) {\n        const x = startIndex + i * n;\n        const fromX = fromIndex + i * n;\n        const v = matrix[x];\n        const iv = inverseMatrix[x];\n\n        matrix[x] = matrix[fromX];\n        matrix[fromX] = v;\n\n        inverseMatrix[x] = inverseMatrix[fromX];\n        inverseMatrix[fromX] = iv;\n    }\n}\n\nfunction divide(\n    matrix: number[],\n    inverseMatrix: number[],\n    startIndex: number,\n    n: number,\n    k: number,\n) {\n    for (let i = 0; i < n; ++i) {\n        const x = startIndex + i * n;\n\n        matrix[x] /= k;\n        inverseMatrix[x] /= k;\n    }\n}\n\n/**\n *\n * @namespace Matrix\n */\n/**\n * @memberof Matrix\n */\nexport function ignoreDimension(\n    matrix: number[],\n    m: number,\n    n: number = Math.sqrt(matrix.length),\n) {\n    const newMatrix = matrix.slice();\n\n    for (let i = 0; i < n; ++i) {\n        newMatrix[i * n + m - 1] = 0;\n        newMatrix[(m - 1) * n + i] = 0;\n    }\n    newMatrix[(m - 1) * (n + 1)] = 1;\n\n    return newMatrix;\n}\n\n/**\n * @memberof Matrix\n */\nexport function invert(\n    matrix: number[],\n    n: number = Math.sqrt(matrix.length),\n) {\n    const newMatrix = matrix.slice();\n    const inverseMatrix = createIdentityMatrix(n);\n\n    for (let i = 0; i < n; ++i) {\n        // diagonal\n        const identityIndex = n * i + i;\n\n        if (!throttle(newMatrix[identityIndex], TINY_NUM)) {\n            // newMatrix[identityIndex] = 0;\n            for (let j = i + 1; j < n; ++j) {\n                if (newMatrix[n * i + j]) {\n                    swap(newMatrix, inverseMatrix, i, j, n);\n                    break;\n                }\n            }\n        }\n        if (!throttle(newMatrix[identityIndex], TINY_NUM)) {\n            // no inverse matrix\n            return [];\n        }\n        divide(newMatrix, inverseMatrix, i, n, newMatrix[identityIndex]);\n        for (let j = 0; j < n; ++j) {\n            const targetStartIndex = j;\n            const targetIndex = j + i * n;\n            const target = newMatrix[targetIndex];\n\n            if (!throttle(target, TINY_NUM) || i === j) {\n                continue;\n            }\n            add(newMatrix, inverseMatrix, targetStartIndex, i, n, -target);\n        }\n    }\n\n    return inverseMatrix;\n}\n\n/**\n * @memberof Matrix\n */\nexport function transpose(matrix: number[], n: number = Math.sqrt(matrix.length)) {\n    const newMatrix: number[] = [];\n\n    for (let i = 0; i < n; ++i) {\n        for (let j = 0; j < n; ++j) {\n            newMatrix[j * n + i] = matrix[n * i + j];\n        }\n    }\n    return newMatrix;\n}\n\n/**\n * @memberof Matrix\n */\nexport function getOrigin(matrix: number[], n: number = Math.sqrt(matrix.length)) {\n    const originMatrix: number[] = [];\n    const w = matrix[n * n - 1];\n    for (let i = 0; i < n - 1; ++i) {\n        originMatrix[i] = matrix[n * (n - 1) + i] / w;\n    }\n    originMatrix[n - 1] = 0;\n    return originMatrix;\n}\n\n/**\n * @memberof Matrix\n */\nexport function fromTranslation(pos: number[], n: number) {\n    const newMatrix = createIdentityMatrix(n);\n\n    for (let i = 0; i < n - 1; ++i) {\n        newMatrix[n * (n - 1) + i] = pos[i] || 0;\n    }\n    return newMatrix;\n}\n\n/**\n * @memberof Matrix\n */\nexport function convertPositionMatrix(matrix: number[], n: number) {\n    const newMatrix = matrix.slice();\n\n    for (let i = matrix.length; i < n - 1; ++i) {\n        newMatrix[i] = 0;\n    }\n    newMatrix[n - 1] = 1;\n    return newMatrix;\n}\n\n/**\n * @memberof Matrix\n */\nexport function convertDimension(matrix: number[], n: number = Math.sqrt(matrix.length), m: number) {\n    // n < m\n    if (n === m) {\n        return matrix;\n    }\n    const newMatrix = createIdentityMatrix(m);\n\n    const length = Math.min(n, m);\n    for (let i = 0; i < length - 1; ++i) {\n        for (let j = 0; j < length - 1; ++j) {\n            newMatrix[i * m + j] = matrix[i * n + j];\n        }\n\n        newMatrix[(i + 1) * m - 1] = matrix[(i + 1) * n - 1];\n        newMatrix[(m - 1) * m + i] = matrix[(n - 1) * n + i];\n    }\n    newMatrix[m * m - 1] = matrix[n * n - 1];\n\n    return newMatrix;\n}\n\n/**\n * @memberof Matrix\n */\nexport function multiplies(n: number, ...matrixes: number[][]) {\n    let m: number[] = createIdentityMatrix(n);\n\n    matrixes.forEach(matrix => {\n        m = multiply(m, matrix, n);\n    });\n    return m;\n}\n\n/**\n * @memberof Matrix\n */\nexport function multiply(matrix: number[], matrix2: number[], n: number = Math.sqrt(matrix.length)) {\n    const newMatrix: number[] = [];\n    // 1 y: n\n    // 1 x: m\n    // 2 x: m\n    // 2 y: k\n    // n * m X m * k\n    const m = matrix.length / n;\n    const k = matrix2.length / m;\n\n    if (!m) {\n        return matrix2;\n    } else if (!k) {\n        return matrix;\n    }\n    for (let i = 0; i < n; ++i) {\n        for (let j = 0; j < k; ++j) {\n            newMatrix[j * n + i] = 0;\n            for (let l = 0; l < m; ++l) {\n                // m1 x: m(l), y: n(i)\n                // m2 x: k(j):  y: m(l)\n                // nw x: n(i), y: k(j)\n                newMatrix[j * n + i] += matrix[l * n + i] * matrix2[j * m + l];\n            }\n        }\n    }\n    // n * k\n    return newMatrix;\n}\n\n/**\n * @memberof Matrix\n */\nexport function plus(pos1: number[], pos2: number[]) {\n    const length = Math.min(pos1.length, pos2.length);\n    const nextPos = pos1.slice();\n\n    for (let i = 0; i < length; ++i) {\n        nextPos[i] = nextPos[i] + pos2[i];\n    }\n    return nextPos;\n}\n\n/**\n * @memberof Matrix\n */\nexport function minus(pos1: number[], pos2: number[]) {\n    const length = Math.min(pos1.length, pos2.length);\n    const nextPos = pos1.slice();\n\n    for (let i = 0; i < length; ++i) {\n        nextPos[i] = nextPos[i] - pos2[i];\n    }\n    return nextPos;\n}\n\n/**\n * @memberof Matrix\n */\nexport function convertCSStoMatrix(a: number[], is2d: boolean = a.length === 6) {\n    if (is2d) {\n        return [\n            a[0], a[1], 0,\n            a[2], a[3], 0,\n            a[4], a[5], 1,\n        ];\n    }\n    return a;\n}\n\n/**\n * @memberof Matrix\n */\nexport function convertMatrixtoCSS(a: number[], is2d: boolean = a.length === 9) {\n    if (is2d) {\n        return [\n            a[0], a[1],\n            a[3], a[4],\n            a[6], a[7],\n        ];\n    }\n    return a;\n}\n\n/**\n * @memberof Matrix\n */\nexport function calculate(matrix: number[], matrix2: number[], n: number = matrix2.length) {\n    const result = multiply(matrix, matrix2, n);\n    const k = result[n - 1];\n    return result.map(v => v / k);\n}\n\n/**\n * @memberof Matrix\n */\nexport function rotateX3d(matrix: number[], rad: number) {\n    return multiply(\n        matrix,\n        [\n            1, 0, 0, 0,\n            0, Math.cos(rad), Math.sin(rad), 0,\n            0, -Math.sin(rad), Math.cos(rad), 0,\n            0, 0, 0, 1,\n        ],\n        4,\n    );\n}\n\n/**\n * @memberof Matrix\n */\nexport function rotateY3d(matrix: number[], rad: number) {\n    return multiply(\n        matrix,\n        [\n            Math.cos(rad), 0, -Math.sin(rad), 0,\n            0, 1, 0, 0,\n            Math.sin(rad), 0, Math.cos(rad), 0,\n            0, 0, 0, 1,\n        ],\n        4,\n    );\n}\n\n/**\n * @memberof Matrix\n */\nexport function rotateZ3d(matrix: number[], rad: number) {\n    return multiply(\n        matrix,\n        createRotateMatrix(rad, 4),\n    );\n}\n\n/**\n * @memberof Matrix\n */\nexport function scale3d(matrix: number[], [\n    sx = 1,\n    sy = 1,\n    sz = 1,\n]: number[]) {\n    return multiply(\n        matrix,\n        [\n            sx, 0, 0, 0,\n            0, sy, 0, 0,\n            0, 0, sz, 0,\n            0, 0, 0, 1,\n        ],\n        4,\n    );\n}\n\n/**\n * @memberof Matrix\n */\nexport function rotate(pos: number[], rad: number) {\n    return calculate(\n        createRotateMatrix(rad, 3),\n        convertPositionMatrix(pos, 3),\n    );\n}\n\n/**\n * @memberof Matrix\n */\nexport function translate3d(matrix, [\n    tx = 0,\n    ty = 0,\n    tz = 0,\n]: number[]) {\n    return multiply(\n        matrix,\n        [\n            1, 0, 0, 0,\n            0, 1, 0, 0,\n            0, 0, 1, 0,\n            tx, ty, tz, 1,\n        ],\n        4,\n    );\n}\n/**\n * @memberof Matrix\n */\nexport function matrix3d(matrix1: number[], matrix2: number[]) {\n    return multiply(matrix1, matrix2, 4);\n}\n\n/**\n * @memberof Matrix\n */\nexport function createRotateMatrix(rad: number, n: number) {\n    const cos = Math.cos(rad);\n    const sin = Math.sin(rad);\n    const m = createIdentityMatrix(n);\n\n    // cos -sin\n    // sin cos\n    m[0] = cos;\n    m[1] = sin;\n    m[n] = -sin;\n    m[n + 1] = cos;\n\n    return m;\n}\n\n/**\n * @memberof Matrix\n */\nexport function createIdentityMatrix(n: number) {\n    const length = n * n;\n    const matrix: number[] = [];\n\n    for (let i = 0; i < length; ++i) {\n        matrix[i] = i % (n + 1) ? 0 : 1;\n    }\n    return matrix;\n}\n\n/**\n * @memberof Matrix\n */\nexport function createScaleMatrix(scale: number[], n: number) {\n    const m = createIdentityMatrix(n);\n    const length = Math.min(scale.length, n - 1);\n\n    for (let i = 0; i < length; ++i) {\n        m[(n + 1) * i] = scale[i];\n    }\n    return m;\n}\n\n/**\n * @memberof Matrix\n */\nexport function createOriginMatrix(origin: number[], n: number) {\n    const m = createIdentityMatrix(n);\n    const length = Math.min(origin.length, n - 1);\n\n    for (let i = 0; i < length; ++i) {\n        m[n * (n - 1) + i] = origin[i];\n    }\n    return m;\n}\n\n/**\n * @memberof Matrix\n */\nexport function createWarpMatrix(\n    pos0: number[],\n    pos1: number[],\n    pos2: number[],\n    pos3: number[],\n    nextPos0: number[],\n    nextPos1: number[],\n    nextPos2: number[],\n    nextPos3: number[],\n) {\n    const [x0, y0] = pos0;\n    const [x1, y1] = pos1;\n    const [x2, y2] = pos2;\n    const [x3, y3] = pos3;\n\n    const [u0, v0] = nextPos0;\n    const [u1, v1] = nextPos1;\n    const [u2, v2] = nextPos2;\n    const [u3, v3] = nextPos3;\n\n    const matrix = [\n        x0, 0, x1, 0, x2, 0, x3, 0,\n        y0, 0, y1, 0, y2, 0, y3, 0,\n        1, 0, 1, 0, 1, 0, 1, 0,\n        0, x0, 0, x1, 0, x2, 0, x3,\n        0, y0, 0, y1, 0, y2, 0, y3,\n        0, 1, 0, 1, 0, 1, 0, 1,\n        -u0 * x0, -v0 * x0, -u1 * x1, -v1 * x1, -u2 * x2, -v2 * x2, -u3 * x3, -v3 * x3,\n        -u0 * y0, -v0 * y0, -u1 * y1, -v1 * y1, -u2 * y2, -v2 * y2, -u3 * y3, -v3 * y3,\n    ];\n    const inverseMatrix = invert(matrix, 8);\n\n    if (!inverseMatrix.length) {\n        return [];\n    }\n    const h = multiply(inverseMatrix, [u0, v0, u1, v1, u2, v2, u3, v3], 8);\n\n    h[8] = 1;\n    return convertDimension(transpose(h), 3, 4);\n}\n\n/**\n * @memberof Matrix\n */\nexport function getCenter(points: number[][]) {\n    return [0, 1].map(i => average(points.map(pos => pos[i])));\n}\n"],"names":["add","matrix","inverseMatrix","startIndex","fromIndex","n","k","i","x","fromX","swap","v","iv","divide","ignoreDimension","m","Math","sqrt","length","newMatrix","slice","invert","createIdentityMatrix","identityIndex","throttle","TINY_NUM","j","targetStartIndex","targetIndex","target","transpose","getOrigin","originMatrix","w","fromTranslation","pos","convertPositionMatrix","convertDimension","min","multiplies","_i","matrixes","forEach","multiply","matrix2","l","plus","pos1","pos2","nextPos","minus","convertCSStoMatrix","a","is2d","convertMatrixtoCSS","calculate","result","map","rotateX3d","rad","cos","sin","rotateY3d","rotateZ3d","createRotateMatrix","scale3d","_a","_b","sx","_c","sy","_d","sz","rotate","translate3d","tx","ty","tz","matrix3d","matrix1","createScaleMatrix","scale","createOriginMatrix","origin","createWarpMatrix","pos0","pos3","nextPos0","nextPos1","nextPos2","nextPos3","x0","y0","x1","y1","x2","y2","x3","y3","u0","v0","u1","v1","u2","v2","u3","v3","h","getCenter","points","average"],"mappings":"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"}